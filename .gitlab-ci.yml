build:windows:
  image: hermedia/chocolatey
  stage: build
  script:
    - choco install --yes python pip opencv
    - python -m pip install meson ninja
    - python -m pip install glad
    - mkdir build && cd build
    - meson setup ..
    - meson compile
    - meson test
    - cd ..

build:debian:
  image: gcc:latest
  stage: build
  script:
    - echo 'echo $K8S_SECRET_GITLAB_TOKEN' > $HOME/.git-askpass && chmod +x $HOME/.git-askpass
    - export GIT_ASKPASS=$HOME/.git-askpass
    - git config --global url."https://api@git.thm.de/".insteadOf "https://git.thm.de/"
    - git config --global url."https://ssh@git.thm.de/".insteadOf "ssh://git@git.thm.de/"
    - git config --global url."https://git@git.thm.de/".insteadOf "git@git.thm.de:"
    - apt-get update
    - apt-get install --yes gfortran-8 build-essential tar curl zip unzip python3-pip
    - update-alternatives --install /usr/bin/gfortran gfortran /usr/bin/gfortran-8 1
    - apt-get install --yes libopencv-dev
    - python3 -m pip install meson ninja
    - python3 -m pip install glad
    - mkdir build && cd build
    - meson setup ..
    - meson compile
    - meson test
    - cd ..

pages:debian:
  image: gcc:latest
  stage: deploy
  script:
  - apt-get update
  - apt-get install --yes doxygen graphviz
  - doxygen
  - mkdir -p public
  - cp -rf doc/html/* public/
  artifacts:
    paths:
    - public
  only:
  - main


